# Requirements Archive: v1.2 Cross-Repo Job Targeting

**Archived:** 2026-02-27
**Status:** SHIPPED

For current requirements, see `.planning/REQUIREMENTS.md`.

---

# Requirements: ClawForge

**Defined:** 2026-02-25
**Core Value:** Agents receive intelligently-constructed prompts with full repo context, so every job starts warm and produces high-quality results without operator intervention

## v1.2 Requirements

Requirements for cross-repo job targeting. Each maps to roadmap phases.

### Configuration & Auth

- [x] **CFG-01**: Each instance has a REPOS.json config defining allowed target repos with owner, repo slug, and aliases
- [x] **CFG-02**: PAT per instance is scoped with contents:write and pull_requests:write on all allowed repos (operator action documented)

### Agent & Tool Schema

- [x] **TOOL-01**: create_job tool accepts optional target_repo parameter validated against allowed repos list
- [x] **TOOL-02**: Agent resolves target repo from natural language using allowed repos config (name/alias matching)
- [x] **TOOL-03**: create-job.js writes target.json sidecar to clawforge job branch when target repo is specified

### Container Execution

- [x] **EXEC-01**: Entrypoint performs two-phase clone — clawforge for config/metadata, target repo (shallow) for Claude's working tree
- [x] **EXEC-02**: SOUL.md and AGENT.md baked into Docker image so cross-repo jobs have system prompt
- [x] **EXEC-03**: Clone failure captured as explicit failure stage with clone-error.md artifact
- [x] **EXEC-04**: gh auth setup-git used for all clones (no PAT in clone URLs)

### PR Pipeline

- [x] **PR-01**: Entrypoint reads target.json directly from the clawforge job branch (/job/logs/${JOB_ID}/target.json) and derives TARGET_REPO_URL internally; run-job.yml is unchanged
- [x] **PR-02**: Entrypoint creates PR on target repo via gh pr create --repo owner/repo
- [x] **PR-03**: Default branch detected via gh repo view (not hardcoded to main)
- [x] **PR-04**: PR body includes ClawForge attribution with job ID and originating system
- [x] **PR-05**: Cross-repo branches use clawforge/{uuid} naming convention in target repos

### Notifications

- [x] **NOTIF-01**: Entrypoint sends completion webhook POST to Event Handler for cross-repo jobs
- [x] **NOTIF-02**: job_outcomes table has nullable target_repo column recording which repo was targeted
- [x] **NOTIF-03**: Success notifications include correct target repo PR URL in Slack/Telegram messages
- [x] **NOTIF-04**: get_job_status tool returns target repo PR URL when available

### Regression Safety

- [x] **REG-01**: Same-repo jobs work identically when TARGET_REPO_URL is absent or equals REPO_URL
- [x] **REG-02**: Both instances (Noah/Archie and StrategyES/Epic) verified end-to-end after all changes

## Future Requirements

Deferred to future release. Tracked but not in current roadmap.

### Instance Management

- **INST-01**: Archie can spin up new agent instances from a template (instance generator)
- **INST-02**: Per-instance onboarding flow with channel setup and repo scoping
- **INST-03**: Instance health dashboard showing job success rates per agent

### Advanced Features

- **ADV-01**: Multi-repo fan-out jobs (one task dispatched to multiple repos)
- **ADV-02**: GitHub App tokens replacing PATs for finer permission control
- **ADV-03**: Self-improving agents reviewing own success/failure patterns

## Out of Scope

Explicitly excluded. Documented to prevent scope creep.

| Feature | Reason |
|---------|--------|
| Auto-merge on target repos | Target repos control their own merge policies; ClawForge creates PRs, doesn't merge them |
| Dynamic repo discovery via GitHub API | Security risk — exposes full org repo surface; explicit allowed list is safer |
| One PAT with org-wide access | Blast radius too large if compromised; scoped PATs per instance |
| Cross-repo jobs touching multiple repos | Requires transaction model that doesn't exist; use sequential single-repo jobs |
| Installing ClawForge workflows in target repos | Creates tight coupling; entrypoint handles notification directly |
| Store target repo working tree on clawforge branch | Target repos can be gigabytes; only logs commit to clawforge |

## Traceability

Which phases cover which requirements. Updated during roadmap creation.

| Requirement | Phase | Status |
|-------------|-------|--------|
| CFG-01 | Phase 9 | Complete |
| CFG-02 | Phase 9 | Complete |
| TOOL-01 | Phase 9 | Complete |
| TOOL-02 | Phase 9 | Complete |
| TOOL-03 | Phase 9 | Complete |
| EXEC-02 | Phase 9 | Complete |
| EXEC-04 | Phase 9 | Complete |
| PR-01 | Phase 10 | Complete |
| EXEC-01 | Phase 10 | Complete |
| EXEC-03 | Phase 10 | Complete |
| PR-02 | Phase 10 | Complete |
| PR-03 | Phase 10 | Complete |
| PR-04 | Phase 10 | Complete |
| PR-05 | Phase 10 | Complete |
| NOTIF-01 | Phase 11 | Complete |
| NOTIF-02 | Phase 11 | Complete |
| NOTIF-03 | Phase 11 | Complete |
| NOTIF-04 | Phase 11 | Complete |
| REG-01 | Phase 12 | Complete |
| REG-02 | Phase 12 | Complete |

**Coverage:**
- v1.2 requirements: 20 total
- Mapped to phases: 20
- Unmapped: 0 ✓

---
*Requirements defined: 2026-02-25*
*Last updated: 2026-02-27 — EXEC-01, EXEC-03 complete (10-01); PR-01 wording corrected (10-01)*
