---
phase: 02-output-observability
plan: 02
type: execute
wave: 2
depends_on: [02-01]
files_modified:
  - .github/workflows/notify-pr-complete.yml
  - templates/.github/workflows/notify-pr-complete.yml
autonomous: true
requirements: [OBSV-03]

must_haves:
  truths:
    - "The notify-pr-complete workflow's log search finds gsd-invocations.jsonl and populates the log field in the notification payload"
    - "The workflow contains a comment explaining the relationship between the PostToolUse hook output and the *.jsonl search"
    - "The template workflow file matches the live workflow file"
  artifacts:
    - path: ".github/workflows/notify-pr-complete.yml"
      provides: "Notification workflow with clarifying comment about hook-created JSONL"
      contains: "gsd-invocations.jsonl"
    - path: "templates/.github/workflows/notify-pr-complete.yml"
      provides: "Template copy of workflow (byte-for-byte match)"
  key_links:
    - from: ".github/workflows/notify-pr-complete.yml"
      to: "logs/{JOB_ID}/gsd-invocations.jsonl"
      via: "find command searching *.jsonl"
      pattern: 'find.*\*\.jsonl'
---

<objective>
Add clarifying comments to notify-pr-complete.yml documenting the hook-created JSONL relationship, and sync template.

Purpose: OBSV-03 is resolved by OBSV-02 creating the JSONL file the workflow already searches for. This plan adds documentation comments so future maintainers understand the dependency, and ensures the template stays in sync.

Output: Annotated workflow with clear hook-to-notification link, synced template.
</objective>

<execution_context>
@/Users/nwessel/.claude/get-shit-done/workflows/execute-plan.md
@/Users/nwessel/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-output-observability/02-RESEARCH.md
@.planning/phases/02-output-observability/02-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add clarifying comment to notify-pr-complete.yml and sync template</name>
  <files>
    .github/workflows/notify-pr-complete.yml
    templates/.github/workflows/notify-pr-complete.yml
  </files>
  <action>
**1. Modify `.github/workflows/notify-pr-complete.yml`:**

In Step 5 (the "Read log file" section, around line 80-88), update the comment from:

```yaml
          # 5. Read log file (find .jsonl in logs/{jobId}/)
```

to:

```yaml
          # 5. Read GSD invocation log (gsd-invocations.jsonl written by PostToolUse hook in job container)
          # The hook (docker/job/hooks/gsd-invocations.js) appends one JSONL record per Skill tool invocation.
          # This search finds it and sends the content in the notification payload's "log" field.
```

This clarifies: (a) what file is being searched for, (b) where it comes from, and (c) what happens with it.

Also update the live workflow to use `${RUNNER_TEMP:-/tmp}` for the payload path if it doesn't already (checking the live file: it already uses `"${RUNNER_TEMP:-/tmp}/payload.json"` — no change needed).

**2. Sync template:**

Copy `.github/workflows/notify-pr-complete.yml` byte-for-byte to `templates/.github/workflows/notify-pr-complete.yml`.

Currently both files are identical. After adding the comment to the live file, copy it to the template to maintain zero drift.
  </action>
  <verify>
    <automated>cd "/Users/nwessel/Claude Code/Business/Products/clawforge" && grep -q 'PostToolUse hook' .github/workflows/notify-pr-complete.yml && grep -q 'gsd-invocations.js' .github/workflows/notify-pr-complete.yml && diff .github/workflows/notify-pr-complete.yml templates/.github/workflows/notify-pr-complete.yml && echo "PASS" || echo "FAIL"</automated>
  </verify>
  <done>
    - .github/workflows/notify-pr-complete.yml has clarifying comment explaining the PostToolUse hook creates the JSONL file the workflow reads
    - templates/.github/workflows/notify-pr-complete.yml is byte-for-byte identical to the live file
  </done>
</task>

</tasks>

<verification>
1. The workflow comment explicitly names `gsd-invocations.jsonl`, the PostToolUse hook, and the notification payload's `log` field
2. The `find "$LOG_DIR" -name "*.jsonl"` search logic is unchanged (it already works correctly)
3. Template file matches live file with zero drift
</verification>

<success_criteria>
- Workflow file documents the hook-to-notification dependency clearly
- No functional changes to workflow logic (search, payload, curl — all unchanged)
- Template has zero drift from live file
</success_criteria>

<output>
After completion, create `.planning/phases/02-output-observability/02-02-SUMMARY.md`
</output>
